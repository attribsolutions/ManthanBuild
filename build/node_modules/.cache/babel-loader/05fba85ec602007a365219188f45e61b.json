{"ast":null,"code":"import _objectSpread from\"D:/Rohit/Git projects/Manthan/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:/Rohit/Git projects/Manthan/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"D:/Rohit/Git projects/Manthan/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";var _excluded=[\"history\",\"component\",\"layout\",\"isAuthProtected\"];import React,{useEffect}from\"react\";import{Route,Redirect}from\"react-router-dom\";import{useState}from\"react\";import{useDispatch}from\"react-redux\";import{sessionAliveNewToken}from\"../../store/auth/sessionAlive/actions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var intervalId;var Authmiddleware=function Authmiddleware(_ref){var history=_ref.history,Component=_ref.component,Layout=_ref.layout,isAuthProtected=_ref.isAuthProtected,rest=_objectWithoutProperties(_ref,_excluded);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),islogOut=_useState2[0],setIsLogOut=_useState2[1];var dispatch=useDispatch();useEffect(function(){if(isAuthProtected){var timer;var hasNoActivity=function hasNoActivity(){var now=new Date().getTime();var timeSinceLastActivity=now-sessionStorage.getItem('keepSessionAlive2');var minutesSinceLastActivity=Math.floor(timeSinceLastActivity/1000/60);//console.log(\" hasNoActivity main body\", timeSinceLastActivity, \"---- \" ,(timeSinceLastActivity > 50000), \"-----\", new Date()) //##########################\nif(timeSinceLastActivity>1700000){//29 min\n//console.log(\" hasNoActivity  **logOut** \", new Date())  //##########################\nclearInterval(intervalId);clearInterval(timer);sessionStorage.clear();localStorage.clear();setIsLogOut(true);history.push({pathname:'/logout'});window.location.reload(true);}else{//console.log(\" hasNoActivity  **reset**\", new Date()) //##########################\nresetTimer();}};var startTimer=function startTimer(){// //console.log(\" startTimer\", new Date()) //##########################\ntimer=setInterval(hasNoActivity,30*60*1000);};var resetTimer=function resetTimer(){// //console.log(\" resetTimer\", new Date())  //##########################\nsessionStorage.setItem('keepSessionAlive2',new Date().getTime());clearInterval(timer);startTimer();};var hasActivity=sessionStorage.getItem('lastActivityTime',new Date());!hasActivity&&keepSessionAlive(dispatch);localStorage.getItem(\"token\")&&startTimer();window.addEventListener('keydown',resetTimer);window.addEventListener('mousemove',resetTimer);window.addEventListener('keypress',resetTimer);return function(){//console.log(\" return autologout will mount\", new Date())  //##########################\nclearInterval(timer);document.removeEventListener('keydown',resetTimer);window.removeEventListener('mousemove',resetTimer);window.removeEventListener('keypress',resetTimer);};}},[]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Route,_objectSpread(_objectSpread({},rest),{},{render:function render(props){if(islogOut||isAuthProtected&&!localStorage.getItem(\"token\")){return/*#__PURE__*/_jsx(Redirect,{to:{pathname:\"/login\",state:{from:props.location}}});}return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(Component,_objectSpread({},props))});}}))});};export default Authmiddleware;var updateTokan=function updateTokan(dispatch){var istoken=localStorage.getItem(\"refreshToken\");if(istoken){//console.log(\" keepSessionAlive  api call\", new Date()) //##########################\nvar jsonBody={\"refresh\":\"\".concat(istoken)};dispatch(sessionAliveNewToken(jsonBody));}};var keepSessionAlive=function keepSessionAlive(dispatch){//console.log(\" keepSessionAlive\", new Date()) //##########################\nsessionStorage.setItem('keepSessionAlive',new Date());intervalId=setInterval(function(){updateTokan(dispatch);},28*60*1000);};","map":{"version":3,"names":["React","useEffect","Route","Redirect","useState","useDispatch","sessionAliveNewToken","intervalId","Authmiddleware","history","Component","component","Layout","layout","isAuthProtected","rest","islogOut","setIsLogOut","dispatch","timer","hasNoActivity","now","Date","getTime","timeSinceLastActivity","sessionStorage","getItem","minutesSinceLastActivity","Math","floor","clearInterval","clear","localStorage","push","pathname","window","location","reload","resetTimer","startTimer","setInterval","setItem","hasActivity","keepSessionAlive","addEventListener","document","removeEventListener","props","state","from","updateTokan","istoken","jsonBody"],"sources":["D:/Rohit/Git projects/Manthan/src/routes/middleware/Authmiddleware.js"],"sourcesContent":["import React, { useEffect } from \"react\"\r\nimport PropTypes from \"prop-types\"\r\nimport { Route, Redirect } from \"react-router-dom\"\r\nimport { useState } from \"react\"\r\nimport { useDispatch } from \"react-redux\"\r\nimport { sessionAliveNewToken } from \"../../store/auth/sessionAlive/actions\"\r\n\r\nlet intervalId\r\n\r\nconst Authmiddleware = ({\r\n  history: history,\r\n  component: Component,\r\n  layout: Layout,\r\n  isAuthProtected,\r\n  ...rest\r\n}) => {\r\n\r\n  const [islogOut, setIsLogOut] = useState(false)\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n\r\n\r\n    if (isAuthProtected) {\r\n\r\n\r\n      let timer\r\n\r\n      const hasNoActivity = () => {\r\n\r\n        const now = new Date().getTime();\r\n        const timeSinceLastActivity = now - sessionStorage.getItem('keepSessionAlive2');\r\n        const minutesSinceLastActivity = Math.floor((timeSinceLastActivity / 1000) / 60);\r\n        //console.log(\" hasNoActivity main body\", timeSinceLastActivity, \"---- \" ,(timeSinceLastActivity > 50000), \"-----\", new Date()) //##########################\r\n\r\n        if ((timeSinceLastActivity > 1700000)) {//29 min\r\n          //console.log(\" hasNoActivity  **logOut** \", new Date())  //##########################\r\n\r\n          clearInterval(intervalId);\r\n          clearInterval(timer);\r\n          sessionStorage.clear()\r\n          localStorage.clear()\r\n          setIsLogOut(true)\r\n          history.push({ pathname: '/logout' })\r\n          window.location.reload(true)\r\n        } else {\r\n          //console.log(\" hasNoActivity  **reset**\", new Date()) //##########################\r\n          resetTimer();\r\n        }\r\n\r\n      }\r\n\r\n      const startTimer = () => {\r\n        // //console.log(\" startTimer\", new Date()) //##########################\r\n        timer = setInterval(hasNoActivity, 30 * 60 * 1000);\r\n      };\r\n\r\n      const resetTimer = () => {\r\n        // //console.log(\" resetTimer\", new Date())  //##########################\r\n        sessionStorage.setItem('keepSessionAlive2', new Date().getTime())\r\n        clearInterval(timer);\r\n        startTimer();\r\n      };\r\n\r\n      let hasActivity = sessionStorage.getItem('lastActivityTime', new Date())\r\n      !hasActivity && keepSessionAlive(dispatch);\r\n      localStorage.getItem(\"token\") && startTimer()\r\n\r\n      window.addEventListener('keydown', resetTimer);\r\n      window.addEventListener('mousemove', resetTimer);\r\n      window.addEventListener('keypress', resetTimer);\r\n\r\n\r\n      return () => {\r\n        //console.log(\" return autologout will mount\", new Date())  //##########################\r\n\r\n        clearInterval(timer);\r\n        document.removeEventListener('keydown', resetTimer);\r\n        window.removeEventListener('mousemove', resetTimer);\r\n        window.removeEventListener('keypress', resetTimer);\r\n      };\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n\r\n      <Route\r\n        {...rest}\r\n\r\n        render={props => {\r\n\r\n          if (islogOut || (isAuthProtected && !localStorage.getItem(\"token\"))) {\r\n            return (\r\n              <Redirect\r\n                to={{ pathname: \"/login\", state: { from: props.location } }} />\r\n            )\r\n          }\r\n          return (\r\n            <Layout>\r\n              <Component {...props} />\r\n            </Layout>\r\n          )\r\n        }}\r\n      /></>\r\n  )\r\n}\r\n\r\nAuthmiddleware.propTypes = {\r\n  isAuthProtected: PropTypes.bool,\r\n  component: PropTypes.any,\r\n  location: PropTypes.object,\r\n  layout: PropTypes.any,\r\n  userPageAccess: PropTypes.any,\r\n  history: PropTypes.object,\r\n}\r\n\r\nexport default Authmiddleware;\r\n\r\n\r\nconst updateTokan = (dispatch) => {\r\n  let istoken = localStorage.getItem(\"refreshToken\")\r\n  if (istoken) {\r\n    //console.log(\" keepSessionAlive  api call\", new Date()) //##########################\r\n\r\n    let jsonBody = { \"refresh\": `${istoken}` }\r\n    dispatch(sessionAliveNewToken(jsonBody))\r\n  }\r\n}\r\n\r\nconst keepSessionAlive = (dispatch) => {\r\n  //console.log(\" keepSessionAlive\", new Date()) //##########################\r\n\r\n  sessionStorage.setItem('keepSessionAlive', new Date())\r\n  intervalId = setInterval(() => {updateTokan(dispatch)}, 28 * 60 * 1000)\r\n};\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}