{"ast":null,"code":"'use strict';\n/* global MathJax:false */\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../lib');\n\nvar strTranslate = Lib.strTranslate;\n\nvar xmlnsNamespaces = require('../constants/xmlns_namespaces');\n\nvar LINE_SPACING = require('../constants/alignment').LINE_SPACING; // text converter\n\n\nvar FIND_TEX = /([^$]*)([$]+[^$]*[$]+)([^$]*)/;\n\nexports.convertToTspans = function (_context, gd, _callback) {\n  var str = _context.text(); // Until we get tex integrated more fully (so it can be used along with non-tex)\n  // allow some elements to prohibit it by attaching 'data-notex' to the original\n\n\n  var tex = !_context.attr('data-notex') && gd && gd._context.typesetMath && typeof MathJax !== 'undefined' && str.match(FIND_TEX);\n  var parent = d3.select(_context.node().parentNode);\n  if (parent.empty()) return;\n  var svgClass = _context.attr('class') ? _context.attr('class').split(' ')[0] : 'text';\n  svgClass += '-math';\n  parent.selectAll('svg.' + svgClass).remove();\n  parent.selectAll('g.' + svgClass + '-group').remove();\n\n  _context.style('display', null).attr({\n    // some callers use data-unformatted *from the <text> element* in 'cancel'\n    // so we need it here even if we're going to turn it into math\n    // these two (plus style and text-anchor attributes) form the key we're\n    // going to use for Drawing.bBox\n    'data-unformatted': str,\n    'data-math': 'N'\n  });\n\n  function showText() {\n    if (!parent.empty()) {\n      svgClass = _context.attr('class') + '-math';\n      parent.select('svg.' + svgClass).remove();\n    }\n\n    _context.text('').style('white-space', 'pre');\n\n    var hasLink = buildSVGText(_context.node(), str);\n\n    if (hasLink) {\n      // at least in Chrome, pointer-events does not seem\n      // to be honored in children of <text> elements\n      // so if we have an anchor, we have to make the\n      // whole element respond\n      _context.style('pointer-events', 'all');\n    }\n\n    exports.positionText(_context);\n    if (_callback) _callback.call(_context);\n  }\n\n  if (tex) {\n    (gd && gd._promises || []).push(new Promise(function (resolve) {\n      _context.style('display', 'none');\n\n      var fontSize = parseInt(_context.node().style.fontSize, 10);\n      var config = {\n        fontSize: fontSize\n      };\n      texToSVG(tex[2], config, function (_svgEl, _glyphDefs, _svgBBox) {\n        parent.selectAll('svg.' + svgClass).remove();\n        parent.selectAll('g.' + svgClass + '-group').remove();\n\n        var newSvg = _svgEl && _svgEl.select('svg');\n\n        if (!newSvg || !newSvg.node()) {\n          showText();\n          resolve();\n          return;\n        }\n\n        var mathjaxGroup = parent.append('g').classed(svgClass + '-group', true).attr({\n          'pointer-events': 'none',\n          'data-unformatted': str,\n          'data-math': 'Y'\n        });\n        mathjaxGroup.node().appendChild(newSvg.node()); // stitch the glyph defs\n\n        if (_glyphDefs && _glyphDefs.node()) {\n          newSvg.node().insertBefore(_glyphDefs.node().cloneNode(true), newSvg.node().firstChild);\n        }\n\n        var w0 = _svgBBox.width;\n        var h0 = _svgBBox.height;\n        newSvg.attr({\n          'class': svgClass,\n          height: h0,\n          preserveAspectRatio: 'xMinYMin meet'\n        }).style({\n          overflow: 'visible',\n          'pointer-events': 'none'\n        });\n        var fill = _context.node().style.fill || 'black';\n        var g = newSvg.select('g');\n        g.attr({\n          fill: fill,\n          stroke: fill\n        });\n        var bb = g.node().getBoundingClientRect();\n        var w = bb.width;\n        var h = bb.height;\n\n        if (w > w0 || h > h0) {\n          // this happen in firefox v82+ | see https://bugzilla.mozilla.org/show_bug.cgi?id=1709251 addressed\n          // temporary fix:\n          newSvg.style('overflow', 'hidden');\n          bb = newSvg.node().getBoundingClientRect();\n          w = bb.width;\n          h = bb.height;\n        }\n\n        var x = +_context.attr('x');\n        var y = +_context.attr('y'); // font baseline is about 1/4 fontSize below centerline\n\n        var textHeight = fontSize || _context.node().getBoundingClientRect().height;\n\n        var dy = -textHeight / 4;\n\n        if (svgClass[0] === 'y') {\n          mathjaxGroup.attr({\n            transform: 'rotate(' + [-90, x, y] + ')' + strTranslate(-w / 2, dy - h / 2)\n          });\n        } else if (svgClass[0] === 'l') {\n          y = dy - h / 2;\n        } else if (svgClass[0] === 'a' && svgClass.indexOf('atitle') !== 0) {\n          x = 0;\n          y = dy;\n        } else {\n          var anchor = _context.attr('text-anchor');\n\n          x = x - w * (anchor === 'middle' ? 0.5 : anchor === 'end' ? 1 : 0);\n          y = y + dy - h / 2;\n        }\n\n        newSvg.attr({\n          x: x,\n          y: y\n        });\n        if (_callback) _callback.call(_context, mathjaxGroup);\n        resolve(mathjaxGroup);\n      });\n    }));\n  } else showText();\n\n  return _context;\n}; // MathJax\n\n\nvar LT_MATCH = /(<|&lt;|&#60;)/g;\nvar GT_MATCH = /(>|&gt;|&#62;)/g;\n\nfunction cleanEscapesForTex(s) {\n  return s.replace(LT_MATCH, '\\\\lt ').replace(GT_MATCH, '\\\\gt ');\n}\n\nvar inlineMath = [['$', '$'], ['\\\\(', '\\\\)']];\n\nfunction texToSVG(_texString, _config, _callback) {\n  var MathJaxVersion = parseInt((MathJax.version || '').split('.')[0]);\n\n  if (MathJaxVersion !== 2 && MathJaxVersion !== 3) {\n    Lib.warn('No MathJax version:', MathJax.version);\n    return;\n  }\n\n  var originalRenderer, originalConfig, originalProcessSectionDelay, tmpDiv;\n\n  var setConfig2 = function setConfig2() {\n    originalConfig = Lib.extendDeepAll({}, MathJax.Hub.config);\n    originalProcessSectionDelay = MathJax.Hub.processSectionDelay;\n\n    if (MathJax.Hub.processSectionDelay !== undefined) {\n      // MathJax 2.5+ but not 3+\n      MathJax.Hub.processSectionDelay = 0;\n    }\n\n    return MathJax.Hub.Config({\n      messageStyle: 'none',\n      tex2jax: {\n        inlineMath: inlineMath\n      },\n      displayAlign: 'left'\n    });\n  };\n\n  var setConfig3 = function setConfig3() {\n    originalConfig = Lib.extendDeepAll({}, MathJax.config);\n\n    if (!MathJax.config.tex) {\n      MathJax.config.tex = {};\n    }\n\n    MathJax.config.tex.inlineMath = inlineMath;\n  };\n\n  var setRenderer2 = function setRenderer2() {\n    originalRenderer = MathJax.Hub.config.menuSettings.renderer;\n\n    if (originalRenderer !== 'SVG') {\n      return MathJax.Hub.setRenderer('SVG');\n    }\n  };\n\n  var setRenderer3 = function setRenderer3() {\n    originalRenderer = MathJax.config.startup.output;\n\n    if (originalRenderer !== 'svg') {\n      MathJax.config.startup.output = 'svg';\n    }\n  };\n\n  var initiateMathJax = function initiateMathJax() {\n    var randomID = 'math-output-' + Lib.randstr({}, 64);\n    tmpDiv = d3.select('body').append('div').attr({\n      id: randomID\n    }).style({\n      visibility: 'hidden',\n      position: 'absolute',\n      'font-size': _config.fontSize + 'px'\n    }).text(cleanEscapesForTex(_texString));\n    var tmpNode = tmpDiv.node();\n    return MathJaxVersion === 2 ? MathJax.Hub.Typeset(tmpNode) : MathJax.typeset([tmpNode]);\n  };\n\n  var finalizeMathJax = function finalizeMathJax() {\n    var sel = tmpDiv.select(MathJaxVersion === 2 ? '.MathJax_SVG' : '.MathJax');\n    var node = !sel.empty() && tmpDiv.select('svg').node();\n\n    if (!node) {\n      Lib.log('There was an error in the tex syntax.', _texString);\n\n      _callback();\n    } else {\n      var nodeBBox = node.getBoundingClientRect();\n      var glyphDefs;\n\n      if (MathJaxVersion === 2) {\n        glyphDefs = d3.select('body').select('#MathJax_SVG_glyphs');\n      } else {\n        glyphDefs = sel.select('defs');\n      }\n\n      _callback(sel, glyphDefs, nodeBBox);\n    }\n\n    tmpDiv.remove();\n  };\n\n  var resetRenderer2 = function resetRenderer2() {\n    if (originalRenderer !== 'SVG') {\n      return MathJax.Hub.setRenderer(originalRenderer);\n    }\n  };\n\n  var resetRenderer3 = function resetRenderer3() {\n    if (originalRenderer !== 'svg') {\n      MathJax.config.startup.output = originalRenderer;\n    }\n  };\n\n  var resetConfig2 = function resetConfig2() {\n    if (originalProcessSectionDelay !== undefined) {\n      MathJax.Hub.processSectionDelay = originalProcessSectionDelay;\n    }\n\n    return MathJax.Hub.Config(originalConfig);\n  };\n\n  var resetConfig3 = function resetConfig3() {\n    MathJax.config = originalConfig;\n  };\n\n  if (MathJaxVersion === 2) {\n    MathJax.Hub.Queue(setConfig2, setRenderer2, initiateMathJax, finalizeMathJax, resetRenderer2, resetConfig2);\n  } else if (MathJaxVersion === 3) {\n    setConfig3();\n    setRenderer3();\n    MathJax.startup.defaultReady();\n    MathJax.startup.promise.then(function () {\n      initiateMathJax();\n      finalizeMathJax();\n      resetRenderer3();\n      resetConfig3();\n    });\n  }\n}\n\nvar TAG_STYLES = {\n  // would like to use baseline-shift for sub/sup but FF doesn't support it\n  // so we need to use dy along with the uber hacky shift-back-to\n  // baseline below\n  sup: 'font-size:70%',\n  sub: 'font-size:70%',\n  b: 'font-weight:bold',\n  i: 'font-style:italic',\n  a: 'cursor:pointer',\n  span: '',\n  em: 'font-style:italic;font-weight:bold'\n}; // baseline shifts for sub and sup\n\nvar SHIFT_DY = {\n  sub: '0.3em',\n  sup: '-0.6em'\n}; // reset baseline by adding a tspan (empty except for a zero-width space)\n// with dy of -70% * SHIFT_DY (because font-size=70%)\n\nvar RESET_DY = {\n  sub: '-0.21em',\n  sup: '0.42em'\n};\nvar ZERO_WIDTH_SPACE = \"\\u200B\";\n/*\n * Whitelist of protocols in user-supplied urls. Mostly we want to avoid javascript\n * and related attack vectors. The empty items are there for IE, that in various\n * versions treats relative paths as having different flavors of no protocol, while\n * other browsers have these explicitly inherit the protocol of the page they're in.\n */\n\nvar PROTOCOLS = ['http:', 'https:', 'mailto:', '', undefined, ':'];\nvar NEWLINES = exports.NEWLINES = /(\\r\\n?|\\n)/g;\nvar SPLIT_TAGS = /(<[^<>]*>)/;\nvar ONE_TAG = /<(\\/?)([^ >]*)(\\s+(.*))?>/i;\nvar BR_TAG = /<br(\\s+.*)?>/i;\nexports.BR_TAG_ALL = /<br(\\s+.*)?>/gi;\n/*\n * style and href: pull them out of either single or double quotes. Also\n * - target: (_blank|_self|_parent|_top|framename)\n *     note that you can't use target to get a popup but if you use popup,\n *     a `framename` will be passed along as the name of the popup window.\n *     per the spec, cannot contain whitespace.\n *     for backward compatibility we default to '_blank'\n * - popup: a custom one for us to enable popup (new window) links. String\n *     for window.open -> strWindowFeatures, like 'menubar=yes,width=500,height=550'\n *     note that at least in Chrome, you need to give at least one property\n *     in this string or the page will open in a new tab anyway. We follow this\n *     convention and will not make a popup if this string is empty.\n *     per the spec, cannot contain whitespace.\n *\n * Because we hack in other attributes with style (sub & sup), drop any trailing\n * semicolon in user-supplied styles so we can consistently append the tag-dependent style\n *\n * These are for tag attributes; Chrome anyway will convert entities in\n * attribute values, but not in attribute names\n * you can test this by for example:\n * > p = document.createElement('p')\n * > p.innerHTML = '<span styl&#x65;=\"font-color:r&#x65;d;\">Hi</span>'\n * > p.innerHTML\n * <- '<span styl&#x65;=\"font-color:red;\">Hi</span>'\n */\n\nvar STYLEMATCH = /(^|[\\s\"'])style\\s*=\\s*(\"([^\"]*);?\"|'([^']*);?')/i;\nvar HREFMATCH = /(^|[\\s\"'])href\\s*=\\s*(\"([^\"]*)\"|'([^']*)')/i;\nvar TARGETMATCH = /(^|[\\s\"'])target\\s*=\\s*(\"([^\"\\s]*)\"|'([^'\\s]*)')/i;\nvar POPUPMATCH = /(^|[\\s\"'])popup\\s*=\\s*(\"([\\w=,]*)\"|'([\\w=,]*)')/i; // dedicated matcher for these quoted regexes, that can return their results\n// in two different places\n\nfunction getQuotedMatch(_str, re) {\n  if (!_str) return null;\n\n  var match = _str.match(re);\n\n  var result = match && (match[3] || match[4]);\n  return result && convertEntities(result);\n}\n\nvar COLORMATCH = /(^|;)\\s*color:/;\n/**\n * Strip string of tags\n *\n * @param {string} _str : input string\n * @param {object} opts :\n * - len {number} max length of output string\n * - allowedTags {array} list of pseudo-html tags to NOT strip\n * @return {string}\n */\n\nexports.plainText = function (_str, opts) {\n  opts = opts || {};\n  var len = opts.len !== undefined && opts.len !== -1 ? opts.len : Infinity;\n  var allowedTags = opts.allowedTags !== undefined ? opts.allowedTags : ['br'];\n  var ellipsis = '...';\n  var eLen = ellipsis.length;\n\n  var oldParts = _str.split(SPLIT_TAGS);\n\n  var newParts = [];\n  var prevTag = '';\n  var l = 0;\n\n  for (var i = 0; i < oldParts.length; i++) {\n    var p = oldParts[i];\n    var match = p.match(ONE_TAG);\n    var tagType = match && match[2].toLowerCase();\n\n    if (tagType) {\n      // N.B. tags do not count towards string length\n      if (allowedTags.indexOf(tagType) !== -1) {\n        newParts.push(p);\n        prevTag = tagType;\n      }\n    } else {\n      var pLen = p.length;\n\n      if (l + pLen < len) {\n        newParts.push(p);\n        l += pLen;\n      } else if (l < len) {\n        var pLen2 = len - l;\n\n        if (prevTag && (prevTag !== 'br' || pLen2 <= eLen || pLen <= eLen)) {\n          newParts.pop();\n        }\n\n        if (len > eLen) {\n          newParts.push(p.substr(0, pLen2 - eLen) + ellipsis);\n        } else {\n          newParts.push(p.substr(0, pLen2));\n        }\n\n        break;\n      }\n\n      prevTag = '';\n    }\n  }\n\n  return newParts.join('');\n};\n/*\n * N.B. HTML entities are listed without the leading '&' and trailing ';'\n * https://www.freeformatter.com/html-entities.html\n *\n * FWIW if we wanted to support the full set, it has 2261 entries:\n * https://www.w3.org/TR/html5/entities.json\n * though I notice that some of these are duplicates and/or are missing \";\"\n * eg: \"&amp;\", \"&amp\", \"&AMP;\", and \"&AMP\" all map to \"&\"\n * We no longer need to include numeric entities here, these are now handled\n * by String.fromCodePoint/fromCharCode\n *\n * Anyway the only ones that are really important to allow are the HTML special\n * chars <, >, and &, because these ones can trigger special processing if not\n * replaced by the corresponding entity.\n */\n\n\nvar entityToUnicode = {\n  mu: 'μ',\n  amp: '&',\n  lt: '<',\n  gt: '>',\n  nbsp: ' ',\n  times: '×',\n  plusmn: '±',\n  deg: '°'\n}; // NOTE: in general entities can contain uppercase too (so [a-zA-Z]) but all the\n// ones we support use only lowercase. If we ever change that, update the regex.\n\nvar ENTITY_MATCH = /&(#\\d+|#x[\\da-fA-F]+|[a-z]+);/g;\n\nfunction convertEntities(_str) {\n  return _str.replace(ENTITY_MATCH, function (fullMatch, innerMatch) {\n    var outChar;\n\n    if (innerMatch.charAt(0) === '#') {\n      // cannot use String.fromCodePoint in IE\n      outChar = fromCodePoint(innerMatch.charAt(1) === 'x' ? parseInt(innerMatch.substr(2), 16) : parseInt(innerMatch.substr(1), 10));\n    } else outChar = entityToUnicode[innerMatch]; // as in regular HTML, if we didn't decode the entity just\n    // leave the raw text in place.\n\n\n    return outChar || fullMatch;\n  });\n}\n\nexports.convertEntities = convertEntities;\n\nfunction fromCodePoint(code) {\n  // Don't allow overflow. In Chrome this turns into � but I feel like it's\n  // more useful to just not convert it at all.\n  if (code > 0x10FFFF) return;\n  var stringFromCodePoint = String.fromCodePoint;\n  if (stringFromCodePoint) return stringFromCodePoint(code); // IE doesn't have String.fromCodePoint\n  // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/fromCodePoint\n\n  var stringFromCharCode = String.fromCharCode;\n  if (code <= 0xFFFF) return stringFromCharCode(code);\n  return stringFromCharCode((code >> 10) + 0xD7C0, code % 0x400 + 0xDC00);\n}\n/*\n * buildSVGText: convert our pseudo-html into SVG tspan elements, and attach these\n * to containerNode\n *\n * @param {svg text element} containerNode: the <text> node to insert this text into\n * @param {string} str: the pseudo-html string to convert to svg\n *\n * @returns {bool}: does the result contain any links? We need to handle the text element\n *   somewhat differently if it does, so just keep track of this when it happens.\n */\n\n\nfunction buildSVGText(containerNode, str) {\n  /*\n   * Normalize behavior between IE and others wrt newlines and whitespace:pre\n   * this combination makes IE barf https://github.com/plotly/plotly.js/issues/746\n   * Chrome and FF display \\n, \\r, or \\r\\n as a space in this mode.\n   * I feel like at some point we turned these into <br> but currently we don't so\n   * I'm just going to cement what we do now in Chrome and FF\n   */\n  str = str.replace(NEWLINES, ' ');\n  var hasLink = false; // as we're building the text, keep track of what elements we're nested inside\n  // nodeStack will be an array of {node, type, style, href, target, popup}\n  // where only type: 'a' gets the last 3 and node is only added when it's created\n\n  var nodeStack = [];\n  var currentNode;\n  var currentLine = -1;\n\n  function newLine() {\n    currentLine++;\n    var lineNode = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n    d3.select(lineNode).attr({\n      class: 'line',\n      dy: currentLine * LINE_SPACING + 'em'\n    });\n    containerNode.appendChild(lineNode);\n    currentNode = lineNode;\n    var oldNodeStack = nodeStack;\n    nodeStack = [{\n      node: lineNode\n    }];\n\n    if (oldNodeStack.length > 1) {\n      for (var i = 1; i < oldNodeStack.length; i++) {\n        enterNode(oldNodeStack[i]);\n      }\n    }\n  }\n\n  function enterNode(nodeSpec) {\n    var type = nodeSpec.type;\n    var nodeAttrs = {};\n    var nodeType;\n\n    if (type === 'a') {\n      nodeType = 'a';\n      var target = nodeSpec.target;\n      var href = nodeSpec.href;\n      var popup = nodeSpec.popup;\n\n      if (href) {\n        nodeAttrs = {\n          'xlink:xlink:show': target === '_blank' || target.charAt(0) !== '_' ? 'new' : 'replace',\n          target: target,\n          'xlink:xlink:href': href\n        };\n\n        if (popup) {\n          // security: href and target are not inserted as code but\n          // as attributes. popup is, but limited to /[A-Za-z0-9_=,]/\n          nodeAttrs.onclick = 'window.open(this.href.baseVal,this.target.baseVal,\"' + popup + '\");return false;';\n        }\n      }\n    } else nodeType = 'tspan';\n\n    if (nodeSpec.style) nodeAttrs.style = nodeSpec.style;\n    var newNode = document.createElementNS(xmlnsNamespaces.svg, nodeType);\n\n    if (type === 'sup' || type === 'sub') {\n      addTextNode(currentNode, ZERO_WIDTH_SPACE);\n      currentNode.appendChild(newNode);\n      var resetter = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n      addTextNode(resetter, ZERO_WIDTH_SPACE);\n      d3.select(resetter).attr('dy', RESET_DY[type]);\n      nodeAttrs.dy = SHIFT_DY[type];\n      currentNode.appendChild(newNode);\n      currentNode.appendChild(resetter);\n    } else {\n      currentNode.appendChild(newNode);\n    }\n\n    d3.select(newNode).attr(nodeAttrs);\n    currentNode = nodeSpec.node = newNode;\n    nodeStack.push(nodeSpec);\n  }\n\n  function addTextNode(node, text) {\n    node.appendChild(document.createTextNode(text));\n  }\n\n  function exitNode(type) {\n    // A bare closing tag can't close the root node. If we encounter this it\n    // means there's an extra closing tag that can just be ignored:\n    if (nodeStack.length === 1) {\n      Lib.log('Ignoring unexpected end tag </' + type + '>.', str);\n      return;\n    }\n\n    var innerNode = nodeStack.pop();\n\n    if (type !== innerNode.type) {\n      Lib.log('Start tag <' + innerNode.type + '> doesnt match end tag <' + type + '>. Pretending it did match.', str);\n    }\n\n    currentNode = nodeStack[nodeStack.length - 1].node;\n  }\n\n  var hasLines = BR_TAG.test(str);\n  if (hasLines) newLine();else {\n    currentNode = containerNode;\n    nodeStack = [{\n      node: containerNode\n    }];\n  }\n  var parts = str.split(SPLIT_TAGS);\n\n  for (var i = 0; i < parts.length; i++) {\n    var parti = parts[i];\n    var match = parti.match(ONE_TAG);\n    var tagType = match && match[2].toLowerCase();\n    var tagStyle = TAG_STYLES[tagType];\n\n    if (tagType === 'br') {\n      newLine();\n    } else if (tagStyle === undefined) {\n      addTextNode(currentNode, convertEntities(parti));\n    } else {\n      // tag - open or close\n      if (match[1]) {\n        exitNode(tagType);\n      } else {\n        var extra = match[4];\n        var nodeSpec = {\n          type: tagType\n        }; // now add style, from both the tag name and any extra css\n        // Most of the svg css that users will care about is just like html,\n        // but font color is different (uses fill). Let our users ignore this.\n\n        var css = getQuotedMatch(extra, STYLEMATCH);\n\n        if (css) {\n          css = css.replace(COLORMATCH, '$1 fill:');\n          if (tagStyle) css += ';' + tagStyle;\n        } else if (tagStyle) css = tagStyle;\n\n        if (css) nodeSpec.style = css;\n\n        if (tagType === 'a') {\n          hasLink = true;\n          var href = getQuotedMatch(extra, HREFMATCH);\n\n          if (href) {\n            var safeHref = sanitizeHref(href);\n\n            if (safeHref) {\n              nodeSpec.href = safeHref;\n              nodeSpec.target = getQuotedMatch(extra, TARGETMATCH) || '_blank';\n              nodeSpec.popup = getQuotedMatch(extra, POPUPMATCH);\n            }\n          }\n        }\n\n        enterNode(nodeSpec);\n      }\n    }\n  }\n\n  return hasLink;\n}\n\nfunction sanitizeHref(href) {\n  var decodedHref = encodeURI(decodeURI(href));\n  var dummyAnchor1 = document.createElement('a');\n  var dummyAnchor2 = document.createElement('a');\n  dummyAnchor1.href = href;\n  dummyAnchor2.href = decodedHref;\n  var p1 = dummyAnchor1.protocol;\n  var p2 = dummyAnchor2.protocol; // check safe protocols\n\n  if (PROTOCOLS.indexOf(p1) !== -1 && PROTOCOLS.indexOf(p2) !== -1) {\n    return decodedHref;\n  } else {\n    return '';\n  }\n}\n/*\n * sanitizeHTML: port of buildSVGText aimed at providing a clean subset of HTML\n * @param {string} str: the html string to clean\n * @returns {string}: a cleaned and normalized version of the input,\n *     supporting only a small subset of html\n */\n\n\nexports.sanitizeHTML = function sanitizeHTML(str) {\n  str = str.replace(NEWLINES, ' ');\n  var rootNode = document.createElement('p');\n  var currentNode = rootNode;\n  var nodeStack = [];\n  var parts = str.split(SPLIT_TAGS);\n\n  for (var i = 0; i < parts.length; i++) {\n    var parti = parts[i];\n    var match = parti.match(ONE_TAG);\n    var tagType = match && match[2].toLowerCase();\n\n    if (tagType in TAG_STYLES) {\n      if (match[1]) {\n        if (nodeStack.length) {\n          currentNode = nodeStack.pop();\n        }\n      } else {\n        var extra = match[4];\n        var css = getQuotedMatch(extra, STYLEMATCH);\n        var nodeAttrs = css ? {\n          style: css\n        } : {};\n\n        if (tagType === 'a') {\n          var href = getQuotedMatch(extra, HREFMATCH);\n\n          if (href) {\n            var safeHref = sanitizeHref(href);\n\n            if (safeHref) {\n              nodeAttrs.href = safeHref;\n              var target = getQuotedMatch(extra, TARGETMATCH);\n\n              if (target) {\n                nodeAttrs.target = target;\n              }\n            }\n          }\n        }\n\n        var newNode = document.createElement(tagType);\n        currentNode.appendChild(newNode);\n        d3.select(newNode).attr(nodeAttrs);\n        currentNode = newNode;\n        nodeStack.push(newNode);\n      }\n    } else {\n      currentNode.appendChild(document.createTextNode(convertEntities(parti)));\n    }\n  }\n\n  var key = 'innerHTML'; // i.e. to avoid pass test-syntax\n\n  return rootNode[key];\n};\n\nexports.lineCount = function lineCount(s) {\n  return s.selectAll('tspan.line').size() || 1;\n};\n\nexports.positionText = function positionText(s, x, y) {\n  return s.each(function () {\n    var text = d3.select(this);\n\n    function setOrGet(attr, val) {\n      if (val === undefined) {\n        val = text.attr(attr);\n\n        if (val === null) {\n          text.attr(attr, 0);\n          val = 0;\n        }\n      } else text.attr(attr, val);\n\n      return val;\n    }\n\n    var thisX = setOrGet('x', x);\n    var thisY = setOrGet('y', y);\n\n    if (this.nodeName === 'text') {\n      text.selectAll('tspan.line').attr({\n        x: thisX,\n        y: thisY\n      });\n    }\n  });\n};\n\nfunction alignHTMLWith(_base, container, options) {\n  var alignH = options.horizontalAlign;\n  var alignV = options.verticalAlign || 'top';\n\n  var bRect = _base.node().getBoundingClientRect();\n\n  var cRect = container.node().getBoundingClientRect();\n  var thisRect;\n  var getTop;\n  var getLeft;\n\n  if (alignV === 'bottom') {\n    getTop = function getTop() {\n      return bRect.bottom - thisRect.height;\n    };\n  } else if (alignV === 'middle') {\n    getTop = function getTop() {\n      return bRect.top + (bRect.height - thisRect.height) / 2;\n    };\n  } else {\n    // default: top\n    getTop = function getTop() {\n      return bRect.top;\n    };\n  }\n\n  if (alignH === 'right') {\n    getLeft = function getLeft() {\n      return bRect.right - thisRect.width;\n    };\n  } else if (alignH === 'center') {\n    getLeft = function getLeft() {\n      return bRect.left + (bRect.width - thisRect.width) / 2;\n    };\n  } else {\n    // default: left\n    getLeft = function getLeft() {\n      return bRect.left;\n    };\n  }\n\n  return function () {\n    thisRect = this.node().getBoundingClientRect();\n    var x0 = getLeft() - cRect.left;\n    var y0 = getTop() - cRect.top;\n    var gd = options.gd || {};\n\n    if (options.gd) {\n      gd._fullLayout._calcInverseTransform(gd);\n\n      var transformedCoords = Lib.apply3DTransform(gd._fullLayout._invTransform)(x0, y0);\n      x0 = transformedCoords[0];\n      y0 = transformedCoords[1];\n    }\n\n    this.style({\n      top: y0 + 'px',\n      left: x0 + 'px',\n      'z-index': 1000\n    });\n    return this;\n  };\n}\n\nvar onePx = '1px ';\n\nexports.makeTextShadow = function (color) {\n  var x = onePx;\n  var y = onePx;\n  var b = onePx;\n  return x + y + b + color + ', ' + '-' + x + '-' + y + b + color + ', ' + x + '-' + y + b + color + ', ' + '-' + x + y + b + color;\n};\n/*\n * Editable title\n * @param {d3.selection} context: the element being edited. Normally text,\n *   but if it isn't, you should provide the styling options\n * @param {object} options:\n *   @param {div} options.gd: graphDiv\n *   @param {d3.selection} options.delegate: item to bind events to if not this\n *   @param {boolean} options.immediate: start editing now (true) or on click (false, default)\n *   @param {string} options.fill: font color if not as shown\n *   @param {string} options.background: background color if not as shown\n *   @param {string} options.text: initial text, if not as shown\n *   @param {string} options.horizontalAlign: alignment of the edit box wrt. the bound element\n *   @param {string} options.verticalAlign: alignment of the edit box wrt. the bound element\n */\n\n\nexports.makeEditable = function (context, options) {\n  var gd = options.gd;\n  var _delegate = options.delegate;\n  var dispatch = d3.dispatch('edit', 'input', 'cancel');\n  var handlerElement = _delegate || context;\n  context.style({\n    'pointer-events': _delegate ? 'none' : 'all'\n  });\n  if (context.size() !== 1) throw new Error('boo');\n\n  function handleClick() {\n    appendEditable();\n    context.style({\n      opacity: 0\n    }); // also hide any mathjax svg\n\n    var svgClass = handlerElement.attr('class');\n    var mathjaxClass;\n    if (svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';else mathjaxClass = '[class*=-math-group]';\n\n    if (mathjaxClass) {\n      d3.select(context.node().parentNode).select(mathjaxClass).style({\n        opacity: 0\n      });\n    }\n  }\n\n  function selectElementContents(_el) {\n    var el = _el.node();\n\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n    el.focus();\n  }\n\n  function appendEditable() {\n    var plotDiv = d3.select(gd);\n    var container = plotDiv.select('.svg-container');\n    var div = container.append('div');\n    var cStyle = context.node().style;\n    var fontSize = parseFloat(cStyle.fontSize || 12);\n    var initialText = options.text;\n    if (initialText === undefined) initialText = context.attr('data-unformatted');\n    div.classed('plugin-editable editable', true).style({\n      position: 'absolute',\n      'font-family': cStyle.fontFamily || 'Arial',\n      'font-size': fontSize,\n      color: options.fill || cStyle.fill || 'black',\n      opacity: 1,\n      'background-color': options.background || 'transparent',\n      outline: '#ffffff33 1px solid',\n      margin: [-fontSize / 8 + 1, 0, 0, -1].join('px ') + 'px',\n      padding: '0',\n      'box-sizing': 'border-box'\n    }).attr({\n      contenteditable: true\n    }).text(initialText).call(alignHTMLWith(context, container, options)).on('blur', function () {\n      gd._editing = false;\n      context.text(this.textContent).style({\n        opacity: 1\n      });\n      var svgClass = d3.select(this).attr('class');\n      var mathjaxClass;\n      if (svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';else mathjaxClass = '[class*=-math-group]';\n\n      if (mathjaxClass) {\n        d3.select(context.node().parentNode).select(mathjaxClass).style({\n          opacity: 0\n        });\n      }\n\n      var text = this.textContent;\n      d3.select(this).transition().duration(0).remove();\n      d3.select(document).on('mouseup', null);\n      dispatch.edit.call(context, text);\n    }).on('focus', function () {\n      var editDiv = this;\n      gd._editing = true;\n      d3.select(document).on('mouseup', function () {\n        if (d3.event.target === editDiv) return false;\n        if (document.activeElement === div.node()) div.node().blur();\n      });\n    }).on('keyup', function () {\n      if (d3.event.which === 27) {\n        gd._editing = false;\n        context.style({\n          opacity: 1\n        });\n        d3.select(this).style({\n          opacity: 0\n        }).on('blur', function () {\n          return false;\n        }).transition().remove();\n        dispatch.cancel.call(context, this.textContent);\n      } else {\n        dispatch.input.call(context, this.textContent);\n        d3.select(this).call(alignHTMLWith(context, container, options));\n      }\n    }).on('keydown', function () {\n      if (d3.event.which === 13) this.blur();\n    }).call(selectElementContents);\n  }\n\n  if (options.immediate) handleClick();else handlerElement.on('click', handleClick);\n  return d3.rebind(context, dispatch, 'on');\n};","map":{"version":3,"names":["d3","require","Lib","strTranslate","xmlnsNamespaces","LINE_SPACING","FIND_TEX","exports","convertToTspans","_context","gd","_callback","str","text","tex","attr","typesetMath","MathJax","match","parent","select","node","parentNode","empty","svgClass","split","selectAll","remove","style","showText","hasLink","buildSVGText","positionText","call","_promises","push","Promise","resolve","fontSize","parseInt","config","texToSVG","_svgEl","_glyphDefs","_svgBBox","newSvg","mathjaxGroup","append","classed","appendChild","insertBefore","cloneNode","firstChild","w0","width","h0","height","preserveAspectRatio","overflow","fill","g","stroke","bb","getBoundingClientRect","w","h","x","y","textHeight","dy","transform","indexOf","anchor","LT_MATCH","GT_MATCH","cleanEscapesForTex","s","replace","inlineMath","_texString","_config","MathJaxVersion","version","warn","originalRenderer","originalConfig","originalProcessSectionDelay","tmpDiv","setConfig2","extendDeepAll","Hub","processSectionDelay","undefined","Config","messageStyle","tex2jax","displayAlign","setConfig3","setRenderer2","menuSettings","renderer","setRenderer","setRenderer3","startup","output","initiateMathJax","randomID","randstr","id","visibility","position","tmpNode","Typeset","typeset","finalizeMathJax","sel","log","nodeBBox","glyphDefs","resetRenderer2","resetRenderer3","resetConfig2","resetConfig3","Queue","defaultReady","promise","then","TAG_STYLES","sup","sub","b","i","a","span","em","SHIFT_DY","RESET_DY","ZERO_WIDTH_SPACE","PROTOCOLS","NEWLINES","SPLIT_TAGS","ONE_TAG","BR_TAG","BR_TAG_ALL","STYLEMATCH","HREFMATCH","TARGETMATCH","POPUPMATCH","getQuotedMatch","_str","re","result","convertEntities","COLORMATCH","plainText","opts","len","Infinity","allowedTags","ellipsis","eLen","length","oldParts","newParts","prevTag","l","p","tagType","toLowerCase","pLen","pLen2","pop","substr","join","entityToUnicode","mu","amp","lt","gt","nbsp","times","plusmn","deg","ENTITY_MATCH","fullMatch","innerMatch","outChar","charAt","fromCodePoint","code","stringFromCodePoint","String","stringFromCharCode","fromCharCode","containerNode","nodeStack","currentNode","currentLine","newLine","lineNode","document","createElementNS","svg","class","oldNodeStack","enterNode","nodeSpec","type","nodeAttrs","nodeType","target","href","popup","onclick","newNode","addTextNode","resetter","createTextNode","exitNode","innerNode","hasLines","test","parts","parti","tagStyle","extra","css","safeHref","sanitizeHref","decodedHref","encodeURI","decodeURI","dummyAnchor1","createElement","dummyAnchor2","p1","protocol","p2","sanitizeHTML","rootNode","key","lineCount","size","each","setOrGet","val","thisX","thisY","nodeName","alignHTMLWith","_base","container","options","alignH","horizontalAlign","alignV","verticalAlign","bRect","cRect","thisRect","getTop","getLeft","bottom","top","right","left","x0","y0","_fullLayout","_calcInverseTransform","transformedCoords","apply3DTransform","_invTransform","onePx","makeTextShadow","color","makeEditable","context","_delegate","delegate","dispatch","handlerElement","Error","handleClick","appendEditable","opacity","mathjaxClass","selectElementContents","_el","el","range","createRange","selectNodeContents","window","getSelection","removeAllRanges","addRange","focus","plotDiv","div","cStyle","parseFloat","initialText","fontFamily","background","outline","margin","padding","contenteditable","on","_editing","textContent","transition","duration","edit","editDiv","event","activeElement","blur","which","cancel","input","immediate","rebind"],"sources":["D:/Rohit/Git projects/Manthan/node_modules/plotly.js/src/lib/svg_text_utils.js"],"sourcesContent":["'use strict';\n\n/* global MathJax:false */\n\nvar d3 = require('@plotly/d3');\n\nvar Lib = require('../lib');\nvar strTranslate = Lib.strTranslate;\nvar xmlnsNamespaces = require('../constants/xmlns_namespaces');\nvar LINE_SPACING = require('../constants/alignment').LINE_SPACING;\n\n// text converter\n\nvar FIND_TEX = /([^$]*)([$]+[^$]*[$]+)([^$]*)/;\n\nexports.convertToTspans = function(_context, gd, _callback) {\n    var str = _context.text();\n\n    // Until we get tex integrated more fully (so it can be used along with non-tex)\n    // allow some elements to prohibit it by attaching 'data-notex' to the original\n    var tex = (!_context.attr('data-notex')) &&\n        gd && gd._context.typesetMath &&\n        (typeof MathJax !== 'undefined') &&\n        str.match(FIND_TEX);\n\n    var parent = d3.select(_context.node().parentNode);\n    if(parent.empty()) return;\n    var svgClass = (_context.attr('class')) ? _context.attr('class').split(' ')[0] : 'text';\n    svgClass += '-math';\n    parent.selectAll('svg.' + svgClass).remove();\n    parent.selectAll('g.' + svgClass + '-group').remove();\n    _context.style('display', null)\n        .attr({\n            // some callers use data-unformatted *from the <text> element* in 'cancel'\n            // so we need it here even if we're going to turn it into math\n            // these two (plus style and text-anchor attributes) form the key we're\n            // going to use for Drawing.bBox\n            'data-unformatted': str,\n            'data-math': 'N'\n        });\n\n    function showText() {\n        if(!parent.empty()) {\n            svgClass = _context.attr('class') + '-math';\n            parent.select('svg.' + svgClass).remove();\n        }\n        _context.text('')\n            .style('white-space', 'pre');\n\n        var hasLink = buildSVGText(_context.node(), str);\n\n        if(hasLink) {\n            // at least in Chrome, pointer-events does not seem\n            // to be honored in children of <text> elements\n            // so if we have an anchor, we have to make the\n            // whole element respond\n            _context.style('pointer-events', 'all');\n        }\n\n        exports.positionText(_context);\n\n        if(_callback) _callback.call(_context);\n    }\n\n    if(tex) {\n        ((gd && gd._promises) || []).push(new Promise(function(resolve) {\n            _context.style('display', 'none');\n            var fontSize = parseInt(_context.node().style.fontSize, 10);\n            var config = {fontSize: fontSize};\n\n            texToSVG(tex[2], config, function(_svgEl, _glyphDefs, _svgBBox) {\n                parent.selectAll('svg.' + svgClass).remove();\n                parent.selectAll('g.' + svgClass + '-group').remove();\n\n                var newSvg = _svgEl && _svgEl.select('svg');\n                if(!newSvg || !newSvg.node()) {\n                    showText();\n                    resolve();\n                    return;\n                }\n\n                var mathjaxGroup = parent.append('g')\n                    .classed(svgClass + '-group', true)\n                    .attr({\n                        'pointer-events': 'none',\n                        'data-unformatted': str,\n                        'data-math': 'Y'\n                    });\n\n                mathjaxGroup.node().appendChild(newSvg.node());\n\n                // stitch the glyph defs\n                if(_glyphDefs && _glyphDefs.node()) {\n                    newSvg.node().insertBefore(_glyphDefs.node().cloneNode(true),\n                                               newSvg.node().firstChild);\n                }\n\n                var w0 = _svgBBox.width;\n                var h0 = _svgBBox.height;\n\n                newSvg.attr({\n                    'class': svgClass,\n                    height: h0,\n                    preserveAspectRatio: 'xMinYMin meet'\n                })\n                .style({overflow: 'visible', 'pointer-events': 'none'});\n\n                var fill = _context.node().style.fill || 'black';\n                var g = newSvg.select('g');\n                g.attr({fill: fill, stroke: fill});\n\n                var bb = g.node().getBoundingClientRect();\n                var w = bb.width;\n                var h = bb.height;\n\n                if(w > w0 || h > h0) {\n                    // this happen in firefox v82+ | see https://bugzilla.mozilla.org/show_bug.cgi?id=1709251 addressed\n                    // temporary fix:\n                    newSvg.style('overflow', 'hidden');\n                    bb = newSvg.node().getBoundingClientRect();\n                    w = bb.width;\n                    h = bb.height;\n                }\n\n                var x = +_context.attr('x');\n                var y = +_context.attr('y');\n\n                // font baseline is about 1/4 fontSize below centerline\n                var textHeight = fontSize || _context.node().getBoundingClientRect().height;\n                var dy = -textHeight / 4;\n\n                if(svgClass[0] === 'y') {\n                    mathjaxGroup.attr({\n                        transform: 'rotate(' + [-90, x, y] +\n                        ')' + strTranslate(-w / 2, dy - h / 2)\n                    });\n                } else if(svgClass[0] === 'l') {\n                    y = dy - h / 2;\n                } else if(svgClass[0] === 'a' && svgClass.indexOf('atitle') !== 0) {\n                    x = 0;\n                    y = dy;\n                } else {\n                    var anchor = _context.attr('text-anchor');\n\n                    x = x - w * (\n                        anchor === 'middle' ? 0.5 :\n                        anchor === 'end' ? 1 : 0\n                    );\n                    y = y + dy - h / 2;\n                }\n\n                newSvg.attr({\n                    x: x,\n                    y: y\n                });\n\n                if(_callback) _callback.call(_context, mathjaxGroup);\n                resolve(mathjaxGroup);\n            });\n        }));\n    } else showText();\n\n    return _context;\n};\n\n\n// MathJax\n\nvar LT_MATCH = /(<|&lt;|&#60;)/g;\nvar GT_MATCH = /(>|&gt;|&#62;)/g;\n\nfunction cleanEscapesForTex(s) {\n    return s.replace(LT_MATCH, '\\\\lt ')\n        .replace(GT_MATCH, '\\\\gt ');\n}\n\nvar inlineMath = [['$', '$'], ['\\\\(', '\\\\)']];\n\nfunction texToSVG(_texString, _config, _callback) {\n    var MathJaxVersion = parseInt(\n        (MathJax.version || '').split('.')[0]\n    );\n\n    if(\n        MathJaxVersion !== 2 &&\n        MathJaxVersion !== 3\n    ) {\n        Lib.warn('No MathJax version:', MathJax.version);\n        return;\n    }\n\n    var originalRenderer,\n        originalConfig,\n        originalProcessSectionDelay,\n        tmpDiv;\n\n    var setConfig2 = function() {\n        originalConfig = Lib.extendDeepAll({}, MathJax.Hub.config);\n\n        originalProcessSectionDelay = MathJax.Hub.processSectionDelay;\n        if(MathJax.Hub.processSectionDelay !== undefined) {\n            // MathJax 2.5+ but not 3+\n            MathJax.Hub.processSectionDelay = 0;\n        }\n\n        return MathJax.Hub.Config({\n            messageStyle: 'none',\n            tex2jax: {\n                inlineMath: inlineMath\n            },\n            displayAlign: 'left',\n        });\n    };\n\n    var setConfig3 = function() {\n        originalConfig = Lib.extendDeepAll({}, MathJax.config);\n\n        if(!MathJax.config.tex) {\n            MathJax.config.tex = {};\n        }\n\n        MathJax.config.tex.inlineMath = inlineMath;\n    };\n\n    var setRenderer2 = function() {\n        originalRenderer = MathJax.Hub.config.menuSettings.renderer;\n        if(originalRenderer !== 'SVG') {\n            return MathJax.Hub.setRenderer('SVG');\n        }\n    };\n\n    var setRenderer3 = function() {\n        originalRenderer = MathJax.config.startup.output;\n        if(originalRenderer !== 'svg') {\n            MathJax.config.startup.output = 'svg';\n        }\n    };\n\n    var initiateMathJax = function() {\n        var randomID = 'math-output-' + Lib.randstr({}, 64);\n        tmpDiv = d3.select('body').append('div')\n            .attr({id: randomID})\n            .style({\n                visibility: 'hidden',\n                position: 'absolute',\n                'font-size': _config.fontSize + 'px'\n            })\n            .text(cleanEscapesForTex(_texString));\n\n        var tmpNode = tmpDiv.node();\n\n        return MathJaxVersion === 2 ?\n            MathJax.Hub.Typeset(tmpNode) :\n            MathJax.typeset([tmpNode]);\n    };\n\n    var finalizeMathJax = function() {\n        var sel = tmpDiv.select(\n            MathJaxVersion === 2 ? '.MathJax_SVG' : '.MathJax'\n        );\n\n        var node = !sel.empty() && tmpDiv.select('svg').node();\n        if(!node) {\n            Lib.log('There was an error in the tex syntax.', _texString);\n            _callback();\n        } else {\n            var nodeBBox = node.getBoundingClientRect();\n            var glyphDefs;\n            if(MathJaxVersion === 2) {\n                glyphDefs = d3.select('body').select('#MathJax_SVG_glyphs');\n            } else {\n                glyphDefs = sel.select('defs');\n            }\n            _callback(sel, glyphDefs, nodeBBox);\n        }\n\n        tmpDiv.remove();\n    };\n\n    var resetRenderer2 = function() {\n        if(originalRenderer !== 'SVG') {\n            return MathJax.Hub.setRenderer(originalRenderer);\n        }\n    };\n\n    var resetRenderer3 = function() {\n        if(originalRenderer !== 'svg') {\n            MathJax.config.startup.output = originalRenderer;\n        }\n    };\n\n    var resetConfig2 = function() {\n        if(originalProcessSectionDelay !== undefined) {\n            MathJax.Hub.processSectionDelay = originalProcessSectionDelay;\n        }\n        return MathJax.Hub.Config(originalConfig);\n    };\n\n    var resetConfig3 = function() {\n        MathJax.config = originalConfig;\n    };\n\n    if(MathJaxVersion === 2) {\n        MathJax.Hub.Queue(\n            setConfig2,\n            setRenderer2,\n            initiateMathJax,\n            finalizeMathJax,\n            resetRenderer2,\n            resetConfig2\n        );\n    } else if(MathJaxVersion === 3) {\n        setConfig3();\n        setRenderer3();\n        MathJax.startup.defaultReady();\n\n        MathJax.startup.promise.then(function() {\n            initiateMathJax();\n            finalizeMathJax();\n\n            resetRenderer3();\n            resetConfig3();\n        });\n    }\n}\n\nvar TAG_STYLES = {\n    // would like to use baseline-shift for sub/sup but FF doesn't support it\n    // so we need to use dy along with the uber hacky shift-back-to\n    // baseline below\n    sup: 'font-size:70%',\n    sub: 'font-size:70%',\n    b: 'font-weight:bold',\n    i: 'font-style:italic',\n    a: 'cursor:pointer',\n    span: '',\n    em: 'font-style:italic;font-weight:bold'\n};\n\n// baseline shifts for sub and sup\nvar SHIFT_DY = {\n    sub: '0.3em',\n    sup: '-0.6em'\n};\n// reset baseline by adding a tspan (empty except for a zero-width space)\n// with dy of -70% * SHIFT_DY (because font-size=70%)\nvar RESET_DY = {\n    sub: '-0.21em',\n    sup: '0.42em'\n};\nvar ZERO_WIDTH_SPACE = '\\u200b';\n\n/*\n * Whitelist of protocols in user-supplied urls. Mostly we want to avoid javascript\n * and related attack vectors. The empty items are there for IE, that in various\n * versions treats relative paths as having different flavors of no protocol, while\n * other browsers have these explicitly inherit the protocol of the page they're in.\n */\nvar PROTOCOLS = ['http:', 'https:', 'mailto:', '', undefined, ':'];\n\nvar NEWLINES = exports.NEWLINES = /(\\r\\n?|\\n)/g;\n\nvar SPLIT_TAGS = /(<[^<>]*>)/;\n\nvar ONE_TAG = /<(\\/?)([^ >]*)(\\s+(.*))?>/i;\n\nvar BR_TAG = /<br(\\s+.*)?>/i;\nexports.BR_TAG_ALL = /<br(\\s+.*)?>/gi;\n\n/*\n * style and href: pull them out of either single or double quotes. Also\n * - target: (_blank|_self|_parent|_top|framename)\n *     note that you can't use target to get a popup but if you use popup,\n *     a `framename` will be passed along as the name of the popup window.\n *     per the spec, cannot contain whitespace.\n *     for backward compatibility we default to '_blank'\n * - popup: a custom one for us to enable popup (new window) links. String\n *     for window.open -> strWindowFeatures, like 'menubar=yes,width=500,height=550'\n *     note that at least in Chrome, you need to give at least one property\n *     in this string or the page will open in a new tab anyway. We follow this\n *     convention and will not make a popup if this string is empty.\n *     per the spec, cannot contain whitespace.\n *\n * Because we hack in other attributes with style (sub & sup), drop any trailing\n * semicolon in user-supplied styles so we can consistently append the tag-dependent style\n *\n * These are for tag attributes; Chrome anyway will convert entities in\n * attribute values, but not in attribute names\n * you can test this by for example:\n * > p = document.createElement('p')\n * > p.innerHTML = '<span styl&#x65;=\"font-color:r&#x65;d;\">Hi</span>'\n * > p.innerHTML\n * <- '<span styl&#x65;=\"font-color:red;\">Hi</span>'\n */\nvar STYLEMATCH = /(^|[\\s\"'])style\\s*=\\s*(\"([^\"]*);?\"|'([^']*);?')/i;\nvar HREFMATCH = /(^|[\\s\"'])href\\s*=\\s*(\"([^\"]*)\"|'([^']*)')/i;\nvar TARGETMATCH = /(^|[\\s\"'])target\\s*=\\s*(\"([^\"\\s]*)\"|'([^'\\s]*)')/i;\nvar POPUPMATCH = /(^|[\\s\"'])popup\\s*=\\s*(\"([\\w=,]*)\"|'([\\w=,]*)')/i;\n\n// dedicated matcher for these quoted regexes, that can return their results\n// in two different places\nfunction getQuotedMatch(_str, re) {\n    if(!_str) return null;\n    var match = _str.match(re);\n    var result = match && (match[3] || match[4]);\n    return result && convertEntities(result);\n}\n\nvar COLORMATCH = /(^|;)\\s*color:/;\n\n/**\n * Strip string of tags\n *\n * @param {string} _str : input string\n * @param {object} opts :\n * - len {number} max length of output string\n * - allowedTags {array} list of pseudo-html tags to NOT strip\n * @return {string}\n */\nexports.plainText = function(_str, opts) {\n    opts = opts || {};\n\n    var len = (opts.len !== undefined && opts.len !== -1) ? opts.len : Infinity;\n    var allowedTags = opts.allowedTags !== undefined ? opts.allowedTags : ['br'];\n\n    var ellipsis = '...';\n    var eLen = ellipsis.length;\n\n    var oldParts = _str.split(SPLIT_TAGS);\n    var newParts = [];\n    var prevTag = '';\n    var l = 0;\n\n    for(var i = 0; i < oldParts.length; i++) {\n        var p = oldParts[i];\n        var match = p.match(ONE_TAG);\n        var tagType = match && match[2].toLowerCase();\n\n        if(tagType) {\n            // N.B. tags do not count towards string length\n            if(allowedTags.indexOf(tagType) !== -1) {\n                newParts.push(p);\n                prevTag = tagType;\n            }\n        } else {\n            var pLen = p.length;\n\n            if((l + pLen) < len) {\n                newParts.push(p);\n                l += pLen;\n            } else if(l < len) {\n                var pLen2 = len - l;\n\n                if(prevTag && (prevTag !== 'br' || pLen2 <= eLen || pLen <= eLen)) {\n                    newParts.pop();\n                }\n\n                if(len > eLen) {\n                    newParts.push(p.substr(0, pLen2 - eLen) + ellipsis);\n                } else {\n                    newParts.push(p.substr(0, pLen2));\n                }\n                break;\n            }\n\n            prevTag = '';\n        }\n    }\n\n    return newParts.join('');\n};\n\n/*\n * N.B. HTML entities are listed without the leading '&' and trailing ';'\n * https://www.freeformatter.com/html-entities.html\n *\n * FWIW if we wanted to support the full set, it has 2261 entries:\n * https://www.w3.org/TR/html5/entities.json\n * though I notice that some of these are duplicates and/or are missing \";\"\n * eg: \"&amp;\", \"&amp\", \"&AMP;\", and \"&AMP\" all map to \"&\"\n * We no longer need to include numeric entities here, these are now handled\n * by String.fromCodePoint/fromCharCode\n *\n * Anyway the only ones that are really important to allow are the HTML special\n * chars <, >, and &, because these ones can trigger special processing if not\n * replaced by the corresponding entity.\n */\nvar entityToUnicode = {\n    mu: 'μ',\n    amp: '&',\n    lt: '<',\n    gt: '>',\n    nbsp: ' ',\n    times: '×',\n    plusmn: '±',\n    deg: '°'\n};\n\n// NOTE: in general entities can contain uppercase too (so [a-zA-Z]) but all the\n// ones we support use only lowercase. If we ever change that, update the regex.\nvar ENTITY_MATCH = /&(#\\d+|#x[\\da-fA-F]+|[a-z]+);/g;\nfunction convertEntities(_str) {\n    return _str.replace(ENTITY_MATCH, function(fullMatch, innerMatch) {\n        var outChar;\n        if(innerMatch.charAt(0) === '#') {\n            // cannot use String.fromCodePoint in IE\n            outChar = fromCodePoint(\n                innerMatch.charAt(1) === 'x' ?\n                    parseInt(innerMatch.substr(2), 16) :\n                    parseInt(innerMatch.substr(1), 10)\n            );\n        } else outChar = entityToUnicode[innerMatch];\n\n        // as in regular HTML, if we didn't decode the entity just\n        // leave the raw text in place.\n        return outChar || fullMatch;\n    });\n}\nexports.convertEntities = convertEntities;\n\nfunction fromCodePoint(code) {\n    // Don't allow overflow. In Chrome this turns into � but I feel like it's\n    // more useful to just not convert it at all.\n    if(code > 0x10FFFF) return;\n    var stringFromCodePoint = String.fromCodePoint;\n    if(stringFromCodePoint) return stringFromCodePoint(code);\n\n    // IE doesn't have String.fromCodePoint\n    // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/fromCodePoint\n    var stringFromCharCode = String.fromCharCode;\n    if(code <= 0xFFFF) return stringFromCharCode(code);\n    return stringFromCharCode(\n        (code >> 10) + 0xD7C0,\n        (code % 0x400) + 0xDC00\n    );\n}\n\n/*\n * buildSVGText: convert our pseudo-html into SVG tspan elements, and attach these\n * to containerNode\n *\n * @param {svg text element} containerNode: the <text> node to insert this text into\n * @param {string} str: the pseudo-html string to convert to svg\n *\n * @returns {bool}: does the result contain any links? We need to handle the text element\n *   somewhat differently if it does, so just keep track of this when it happens.\n */\nfunction buildSVGText(containerNode, str) {\n    /*\n     * Normalize behavior between IE and others wrt newlines and whitespace:pre\n     * this combination makes IE barf https://github.com/plotly/plotly.js/issues/746\n     * Chrome and FF display \\n, \\r, or \\r\\n as a space in this mode.\n     * I feel like at some point we turned these into <br> but currently we don't so\n     * I'm just going to cement what we do now in Chrome and FF\n     */\n    str = str.replace(NEWLINES, ' ');\n\n    var hasLink = false;\n\n    // as we're building the text, keep track of what elements we're nested inside\n    // nodeStack will be an array of {node, type, style, href, target, popup}\n    // where only type: 'a' gets the last 3 and node is only added when it's created\n    var nodeStack = [];\n    var currentNode;\n    var currentLine = -1;\n\n    function newLine() {\n        currentLine++;\n\n        var lineNode = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n        d3.select(lineNode).attr({\n            class: 'line',\n            dy: (currentLine * LINE_SPACING) + 'em'\n        });\n        containerNode.appendChild(lineNode);\n\n        currentNode = lineNode;\n\n        var oldNodeStack = nodeStack;\n        nodeStack = [{node: lineNode}];\n\n        if(oldNodeStack.length > 1) {\n            for(var i = 1; i < oldNodeStack.length; i++) {\n                enterNode(oldNodeStack[i]);\n            }\n        }\n    }\n\n    function enterNode(nodeSpec) {\n        var type = nodeSpec.type;\n        var nodeAttrs = {};\n        var nodeType;\n\n        if(type === 'a') {\n            nodeType = 'a';\n            var target = nodeSpec.target;\n            var href = nodeSpec.href;\n            var popup = nodeSpec.popup;\n            if(href) {\n                nodeAttrs = {\n                    'xlink:xlink:show': (target === '_blank' || target.charAt(0) !== '_') ? 'new' : 'replace',\n                    target: target,\n                    'xlink:xlink:href': href\n                };\n                if(popup) {\n                    // security: href and target are not inserted as code but\n                    // as attributes. popup is, but limited to /[A-Za-z0-9_=,]/\n                    nodeAttrs.onclick = 'window.open(this.href.baseVal,this.target.baseVal,\"' +\n                        popup + '\");return false;';\n                }\n            }\n        } else nodeType = 'tspan';\n\n        if(nodeSpec.style) nodeAttrs.style = nodeSpec.style;\n\n        var newNode = document.createElementNS(xmlnsNamespaces.svg, nodeType);\n\n        if(type === 'sup' || type === 'sub') {\n            addTextNode(currentNode, ZERO_WIDTH_SPACE);\n            currentNode.appendChild(newNode);\n\n            var resetter = document.createElementNS(xmlnsNamespaces.svg, 'tspan');\n            addTextNode(resetter, ZERO_WIDTH_SPACE);\n            d3.select(resetter).attr('dy', RESET_DY[type]);\n            nodeAttrs.dy = SHIFT_DY[type];\n\n            currentNode.appendChild(newNode);\n            currentNode.appendChild(resetter);\n        } else {\n            currentNode.appendChild(newNode);\n        }\n\n        d3.select(newNode).attr(nodeAttrs);\n\n        currentNode = nodeSpec.node = newNode;\n        nodeStack.push(nodeSpec);\n    }\n\n    function addTextNode(node, text) {\n        node.appendChild(document.createTextNode(text));\n    }\n\n    function exitNode(type) {\n        // A bare closing tag can't close the root node. If we encounter this it\n        // means there's an extra closing tag that can just be ignored:\n        if(nodeStack.length === 1) {\n            Lib.log('Ignoring unexpected end tag </' + type + '>.', str);\n            return;\n        }\n\n        var innerNode = nodeStack.pop();\n\n        if(type !== innerNode.type) {\n            Lib.log('Start tag <' + innerNode.type + '> doesnt match end tag <' +\n                type + '>. Pretending it did match.', str);\n        }\n        currentNode = nodeStack[nodeStack.length - 1].node;\n    }\n\n    var hasLines = BR_TAG.test(str);\n\n    if(hasLines) newLine();\n    else {\n        currentNode = containerNode;\n        nodeStack = [{node: containerNode}];\n    }\n\n    var parts = str.split(SPLIT_TAGS);\n    for(var i = 0; i < parts.length; i++) {\n        var parti = parts[i];\n        var match = parti.match(ONE_TAG);\n        var tagType = match && match[2].toLowerCase();\n        var tagStyle = TAG_STYLES[tagType];\n\n        if(tagType === 'br') {\n            newLine();\n        } else if(tagStyle === undefined) {\n            addTextNode(currentNode, convertEntities(parti));\n        } else {\n            // tag - open or close\n            if(match[1]) {\n                exitNode(tagType);\n            } else {\n                var extra = match[4];\n\n                var nodeSpec = {type: tagType};\n\n                // now add style, from both the tag name and any extra css\n                // Most of the svg css that users will care about is just like html,\n                // but font color is different (uses fill). Let our users ignore this.\n                var css = getQuotedMatch(extra, STYLEMATCH);\n                if(css) {\n                    css = css.replace(COLORMATCH, '$1 fill:');\n                    if(tagStyle) css += ';' + tagStyle;\n                } else if(tagStyle) css = tagStyle;\n\n                if(css) nodeSpec.style = css;\n\n                if(tagType === 'a') {\n                    hasLink = true;\n\n                    var href = getQuotedMatch(extra, HREFMATCH);\n\n                    if(href) {\n                        var safeHref = sanitizeHref(href);\n                        if(safeHref) {\n                            nodeSpec.href = safeHref;\n                            nodeSpec.target = getQuotedMatch(extra, TARGETMATCH) || '_blank';\n                            nodeSpec.popup = getQuotedMatch(extra, POPUPMATCH);\n                        }\n                    }\n                }\n\n                enterNode(nodeSpec);\n            }\n        }\n    }\n\n    return hasLink;\n}\n\nfunction sanitizeHref(href) {\n    var decodedHref = encodeURI(decodeURI(href));\n    var dummyAnchor1 = document.createElement('a');\n    var dummyAnchor2 = document.createElement('a');\n    dummyAnchor1.href = href;\n    dummyAnchor2.href = decodedHref;\n\n    var p1 = dummyAnchor1.protocol;\n    var p2 = dummyAnchor2.protocol;\n\n    // check safe protocols\n    if(\n        PROTOCOLS.indexOf(p1) !== -1 &&\n        PROTOCOLS.indexOf(p2) !== -1\n    ) {\n        return decodedHref;\n    } else {\n        return '';\n    }\n}\n\n/*\n * sanitizeHTML: port of buildSVGText aimed at providing a clean subset of HTML\n * @param {string} str: the html string to clean\n * @returns {string}: a cleaned and normalized version of the input,\n *     supporting only a small subset of html\n */\nexports.sanitizeHTML = function sanitizeHTML(str) {\n    str = str.replace(NEWLINES, ' ');\n\n    var rootNode = document.createElement('p');\n    var currentNode = rootNode;\n    var nodeStack = [];\n\n    var parts = str.split(SPLIT_TAGS);\n    for(var i = 0; i < parts.length; i++) {\n        var parti = parts[i];\n        var match = parti.match(ONE_TAG);\n        var tagType = match && match[2].toLowerCase();\n\n        if(tagType in TAG_STYLES) {\n            if(match[1]) {\n                if(nodeStack.length) {\n                    currentNode = nodeStack.pop();\n                }\n            } else {\n                var extra = match[4];\n\n                var css = getQuotedMatch(extra, STYLEMATCH);\n                var nodeAttrs = css ? {style: css} : {};\n\n                if(tagType === 'a') {\n                    var href = getQuotedMatch(extra, HREFMATCH);\n\n                    if(href) {\n                        var safeHref = sanitizeHref(href);\n                        if(safeHref) {\n                            nodeAttrs.href = safeHref;\n                            var target = getQuotedMatch(extra, TARGETMATCH);\n                            if(target) {\n                                nodeAttrs.target = target;\n                            }\n                        }\n                    }\n                }\n\n                var newNode = document.createElement(tagType);\n                currentNode.appendChild(newNode);\n                d3.select(newNode).attr(nodeAttrs);\n\n                currentNode = newNode;\n                nodeStack.push(newNode);\n            }\n        } else {\n            currentNode.appendChild(\n                document.createTextNode(convertEntities(parti))\n            );\n        }\n    }\n    var key = 'innerHTML'; // i.e. to avoid pass test-syntax\n    return rootNode[key];\n};\n\nexports.lineCount = function lineCount(s) {\n    return s.selectAll('tspan.line').size() || 1;\n};\n\nexports.positionText = function positionText(s, x, y) {\n    return s.each(function() {\n        var text = d3.select(this);\n\n        function setOrGet(attr, val) {\n            if(val === undefined) {\n                val = text.attr(attr);\n                if(val === null) {\n                    text.attr(attr, 0);\n                    val = 0;\n                }\n            } else text.attr(attr, val);\n            return val;\n        }\n\n        var thisX = setOrGet('x', x);\n        var thisY = setOrGet('y', y);\n\n        if(this.nodeName === 'text') {\n            text.selectAll('tspan.line').attr({x: thisX, y: thisY});\n        }\n    });\n};\n\nfunction alignHTMLWith(_base, container, options) {\n    var alignH = options.horizontalAlign;\n    var alignV = options.verticalAlign || 'top';\n    var bRect = _base.node().getBoundingClientRect();\n    var cRect = container.node().getBoundingClientRect();\n    var thisRect;\n    var getTop;\n    var getLeft;\n\n    if(alignV === 'bottom') {\n        getTop = function() { return bRect.bottom - thisRect.height; };\n    } else if(alignV === 'middle') {\n        getTop = function() { return bRect.top + (bRect.height - thisRect.height) / 2; };\n    } else { // default: top\n        getTop = function() { return bRect.top; };\n    }\n\n    if(alignH === 'right') {\n        getLeft = function() { return bRect.right - thisRect.width; };\n    } else if(alignH === 'center') {\n        getLeft = function() { return bRect.left + (bRect.width - thisRect.width) / 2; };\n    } else { // default: left\n        getLeft = function() { return bRect.left; };\n    }\n\n    return function() {\n        thisRect = this.node().getBoundingClientRect();\n\n        var x0 = getLeft() - cRect.left;\n        var y0 = getTop() - cRect.top;\n        var gd = options.gd || {};\n        if(options.gd) {\n            gd._fullLayout._calcInverseTransform(gd);\n            var transformedCoords = Lib.apply3DTransform(gd._fullLayout._invTransform)(x0, y0);\n            x0 = transformedCoords[0];\n            y0 = transformedCoords[1];\n        }\n\n        this.style({\n            top: y0 + 'px',\n            left: x0 + 'px',\n            'z-index': 1000\n        });\n        return this;\n    };\n}\n\nvar onePx = '1px ';\n\nexports.makeTextShadow = function(color) {\n    var x = onePx;\n    var y = onePx;\n    var b = onePx;\n    return x + y + b + color + ', ' +\n        '-' + x + '-' + y + b + color + ', ' +\n        x + '-' + y + b + color + ', ' +\n        '-' + x + y + b + color;\n};\n\n/*\n * Editable title\n * @param {d3.selection} context: the element being edited. Normally text,\n *   but if it isn't, you should provide the styling options\n * @param {object} options:\n *   @param {div} options.gd: graphDiv\n *   @param {d3.selection} options.delegate: item to bind events to if not this\n *   @param {boolean} options.immediate: start editing now (true) or on click (false, default)\n *   @param {string} options.fill: font color if not as shown\n *   @param {string} options.background: background color if not as shown\n *   @param {string} options.text: initial text, if not as shown\n *   @param {string} options.horizontalAlign: alignment of the edit box wrt. the bound element\n *   @param {string} options.verticalAlign: alignment of the edit box wrt. the bound element\n */\n\nexports.makeEditable = function(context, options) {\n    var gd = options.gd;\n    var _delegate = options.delegate;\n    var dispatch = d3.dispatch('edit', 'input', 'cancel');\n    var handlerElement = _delegate || context;\n\n    context.style({'pointer-events': _delegate ? 'none' : 'all'});\n\n    if(context.size() !== 1) throw new Error('boo');\n\n    function handleClick() {\n        appendEditable();\n        context.style({opacity: 0});\n        // also hide any mathjax svg\n        var svgClass = handlerElement.attr('class');\n        var mathjaxClass;\n        if(svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';\n        else mathjaxClass = '[class*=-math-group]';\n        if(mathjaxClass) {\n            d3.select(context.node().parentNode).select(mathjaxClass).style({opacity: 0});\n        }\n    }\n\n    function selectElementContents(_el) {\n        var el = _el.node();\n        var range = document.createRange();\n        range.selectNodeContents(el);\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n        el.focus();\n    }\n\n    function appendEditable() {\n        var plotDiv = d3.select(gd);\n        var container = plotDiv.select('.svg-container');\n        var div = container.append('div');\n        var cStyle = context.node().style;\n        var fontSize = parseFloat(cStyle.fontSize || 12);\n\n        var initialText = options.text;\n        if(initialText === undefined) initialText = context.attr('data-unformatted');\n\n        div.classed('plugin-editable editable', true)\n            .style({\n                position: 'absolute',\n                'font-family': cStyle.fontFamily || 'Arial',\n                'font-size': fontSize,\n                color: options.fill || cStyle.fill || 'black',\n                opacity: 1,\n                'background-color': options.background || 'transparent',\n                outline: '#ffffff33 1px solid',\n                margin: [-fontSize / 8 + 1, 0, 0, -1].join('px ') + 'px',\n                padding: '0',\n                'box-sizing': 'border-box'\n            })\n            .attr({contenteditable: true})\n            .text(initialText)\n            .call(alignHTMLWith(context, container, options))\n            .on('blur', function() {\n                gd._editing = false;\n                context.text(this.textContent)\n                    .style({opacity: 1});\n                var svgClass = d3.select(this).attr('class');\n                var mathjaxClass;\n                if(svgClass) mathjaxClass = '.' + svgClass.split(' ')[0] + '-math-group';\n                else mathjaxClass = '[class*=-math-group]';\n                if(mathjaxClass) {\n                    d3.select(context.node().parentNode).select(mathjaxClass).style({opacity: 0});\n                }\n                var text = this.textContent;\n                d3.select(this).transition().duration(0).remove();\n                d3.select(document).on('mouseup', null);\n                dispatch.edit.call(context, text);\n            })\n            .on('focus', function() {\n                var editDiv = this;\n                gd._editing = true;\n                d3.select(document).on('mouseup', function() {\n                    if(d3.event.target === editDiv) return false;\n                    if(document.activeElement === div.node()) div.node().blur();\n                });\n            })\n            .on('keyup', function() {\n                if(d3.event.which === 27) {\n                    gd._editing = false;\n                    context.style({opacity: 1});\n                    d3.select(this)\n                        .style({opacity: 0})\n                        .on('blur', function() { return false; })\n                        .transition().remove();\n                    dispatch.cancel.call(context, this.textContent);\n                } else {\n                    dispatch.input.call(context, this.textContent);\n                    d3.select(this).call(alignHTMLWith(context, container, options));\n                }\n            })\n            .on('keydown', function() {\n                if(d3.event.which === 13) this.blur();\n            })\n            .call(selectElementContents);\n    }\n\n    if(options.immediate) handleClick();\n    else handlerElement.on('click', handleClick);\n\n    return d3.rebind(context, dispatch, 'on');\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}